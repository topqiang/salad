<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<link rel="stylesheet" type="text/css" href="__WEBPUBLIC__/Home/css/basic.css">
	<link rel="stylesheet" type="text/css" href="__WEBPUBLIC__/Home/css/style.css">
	<script type="text/javascript" src="__WEBPUBLIC__/Home/js/jquery-1.7.2.min.js"></script>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0" name="viewport" />
	<title>我的菜单</title>
	<style>
		#page_intelOrder{background-color: #e9e9eb;color:#5e6060;font-size: 14px;-webkit-text-size-adjust:none;}
		#page_intelOrder .center{padding:15px 0px;width: 100%; }
		#page_intelOrder header,#page_intelOrder section{margin: 8px;margin-top: 0px;}

		#page_intelOrder section article{background-color: #fff;padding:12px 13px;border-top: 0px;}
		#page_intelOrder section article h2{padding-bottom:10px;}
		#page_intelOrder header{line-height:25px;}
		.pwriter{color:#b1b2b3;font-size:14px;float:left;}
		.pcount{float:right;}
		.pmoney{color:#ff0000;font-size:25px;}
		.pmyname{float:left;color:#5e6060;font-size:16px;font-weight:bold;}
		.pbtn{float:right;}
		.btn_add{padding:5px;background:#2ec366;border-radius:3px;border:0;cursor:pointer;font-size:16px;color:#FFFFFF;}
		.btn_clear{
			padding:5px;
			background:url(__WEBPUBLIC__/Home/images/list_2.png) no-repeat left #ecedef;
			border-radius:3px;
			border:0;
			cursor:pointer;
			font-size:16px;
			color:#4c4c4d;
			padding-left:15px;
			margin-left:15px;}
		.dishname{display:block;line-height:30px;color:#5e6060;font-weight:bold;}
		.order_list{position:relative;border-top: 1px solid #E7EAEB;padding-bottom:5px;}
		.order_count{position:absolute;top:15px;right:0;}
		.dishprice{color:#FF0000;}
		.hide_tier{
			background:#000000;
			opacity:0.5;
			position:fixed;
			width:100%;
			height:100%;
			top:0;
			display:none;}
		.tier{
			position:fixed;
			background:#222222;
			width:205px;
			left: 424.5px;
			box-shadow: 0 0 10px #3f3e3e;
			padding:35px 25px;
			border-radius:3px;
			display:none;}
		.tier_count h3{
			color:#FFFFFF;
			font-size:18px;
			text-align:center;}
		.btn_sure{
			width:80px;
			height:35px;
			background:#38b766;
			border:0;
			color:#FFFFFF;
			font-size:14px;
			border-radius:3px;
			cursor:pointer;}
		.tier_count h1{
			text-align:center;
			margin-top:20px;}
		.tier_one{
			position:relative;}
		.tier_remove{
			position:absolute;
			top:-45px;
			right:-40px;
			cursor:pointer;}
	</style>
</head>

<body id="page_intelOrder">
<div class="center">
	<header>
		<span class="pwriter">为了您能准时就餐，请提前下单</span>
		<span class="pcount">共计：<span class="pmoney">{$total}</span>积分</span>
		<div class="clear"></div>
	</header>
	<section>
		<article>
			<h2>
				<span class="pmyname">我的菜单</span>
				<span class="pbtn">
				<a href="{:U('Index/foodList')}" class="btn_add">+加菜</a>
				<a href="{:U('Index/listClear')}" class="btn_clear">清空</a>
				</span>

				<div style="float: left;margin-top: 20px;">
					付款方式：
					<input type="radio" class="pay_type" name="pay_type" value="2"/>货到付款&nbsp;
					<input type="radio" class="pay_type" name="pay_type" value="1" checked="checked"/>积分兑换
				</div>
				
				<div class="clear"></div>
			</h2>

			<ul class="myorder">
				<volist name="myList" id="vo">
					<li class="order_list">
						<span>
						<span class="dishname">{$vo.name}</span>
						<span class="dishprice">{$vo.score}积分/{$vo.unit}</span>
						</span>
						<span class="order_count">

						<input type="button" value="-" onclick="lowerFood('{$key}');" class="lower" style="display: inline;">
						<span class="text">{$vo['num']}</span>
						<input type="button" value="+" onclick="addFood('{$key}');" class="add">

						</span>
					</li>
				</volist>
			</ul>
		</article>
		<header style="margin-top: 20px;">
			<span class="pwriter">请输入您的订单信息</span>
			<div class="clear"></div>
		</header>
		<div class="order_form">
			<form action="{:U('Order/order')}" method="post" class="order_submit">
				<table width="100%">
					<tr>
						<td class="list_name">电话：</td>
						<td width="80%"><input type="text" value="{$_SESSION['m_tel']}" name="m_tel" class="text1 input_tel"/></td>
                        <td class="list_name"><input type="hidden" name="pay_type" value="1"/></td>
					</tr>
					<tr>
						<td class="list_name">姓名：</td>
						<td><input type="text" value="{$_SESSION['m_name']}" name="m_name" class="text1 input_name"/></td>
					</tr>
					<tr>
						<td class="list_name">地址：</td>
						<td><input type="text" value="{$_SESSION['m_address']}" name="m_address" class="text1 input_address"/></td>
					</tr>
                    <tr>
                        <td class="list_name">职业：</td>
                        <td><input type="text" value="{$_SESSION['m_work']}" name="m_work" class="text1 input_work"/></td>
                    </tr>
					<tr>
						<td class="list_name">备注：</td>
						<td>
							<input type="text" value="" name="message" class="text1" placeholder="若是堂食请输入桌台号"/>
							<!--<textarea class="list_area" name="message"></textarea>-->
						</td>
					</tr>
					<tr>
						<td colspan="10" align="right"><input type="button" class="btn_sure" value="立即下单" onclick="order_submit();"/></td>
					</tr>
				</table>
			</form>
		</div>
	</section>

	<!--<div class="mylist"><a href="###" class="order">立即下单</a></div>-->
</div>
<style>
	.order_form{
		margin: 0px auto;
		/*text-align: center;*/

	}
	.order_form td{
		height:50px;
	}
	.text1{
		width: 97%;
		border: 1px solid #D5D5D5;
		color: #333333;
		font-size: 13px;
		padding: 6px;
		-moz-border-radius: 4px;
		-webkit-border-radius: 4px;
		border-radius: 4px;
		height: 30px;

	}
	.list_name{
		width:15%;
		font-size: 14px;
		font-weight: bold;
	}
	.list_area{
		width:97%;
		border: 1px solid #D5D5D5;
		color: #333333;
		font-size: 13px;
		padding: 6px;
		-moz-border-radius: 4px;
		-webkit-border-radius: 4px;
		border-radius: 4px;
	}
</style>
<script type="text/javascript">
	function order_submit(){
		$.ajax({
			url:"{:U('Order/order',array('pay_type'=>1))}",
			type:"post",
			data:$('.order_submit').serialize(),
			success:function(data){
				if(data['flag']=='error'){
					alert(data['message']);
				}else{
					alert(data['message']);
					location.href="{:U('Order/orderList')}";
				}
			}
		});
	}
	function tatol(){
		$.ajax({
			url:'{:U("Index/getTotal",array("pay_type"=>2))}',
			type:'post',
			success:function(data){
				$('.pmoney').text(data);
			}
		});
	}
	function addFood(fid){
		$.ajax({
			url:'{:U("Index/addFood")}',
			type:'post',
			data:{fid:fid},
			success:function(){

			}
		});
		tatol();
	}
	function lowerFood(fid){
		$.ajax({
			url:'{:U("Index/lowerFood")}',
			type:'post',
			data:{fid:fid},
			success:function(){

			}
		});
		tatol();
	}
	$(function()
	{
		$('.input_tel').blur(function(){
			var tel=this.value;
			$.ajax({
				url:'{:U("Order/getInfo")}',
				type:'get',
				data:{m_tel:tel},
				success:function(data){
					$('.input_name').val(data['m_name']);
					$('.input_address').val(data['m_address']);
                    $('.input_work').val(data['m_work']);
				}
			});
		});
		$('.pay_type').click(function(){
			if(this.value==2){
				location.href="{:U('Index/myList',array('pay_type'=>2))}";
			}
		});
		$(".order_count").click(function()
		{
			$(this).find(".lower").show();
		});

		$(".add").click(function(){
			$(this).parent().find(".lower").show();
			var text = $(this).prev(".text").text();
			text++;
			$(this).prev(".text").text(text);
		});

		$(".lower").click(function(){
			var text = $(this).next(".text").text();
			text--;
			if(text<1){
				$(this).parent().parent().hide();
				$(this).next(".text").text('');
			}else{
				$(this).next(".text").text(text);
			}
		});
	})
</script>
</body>
</html>
